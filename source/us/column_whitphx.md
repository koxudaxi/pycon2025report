## PyCon US 2025 初参加

橘祐一郎（[@whitphx](https://github.com/whitphx)）です。今年初めてPyCon USに参加しました。

PyCon USではたくさんのイベントやトークに参加しましたが、ここではせっかくなので日本からの参加者の中ではおそらく私だけが書ける内容をコラムにしようと思います。

### Wasm Summit

トークの行われる3日間の前に、チュートリアルなどのための期間が2日間あり、Summitというタイプのイベントもそこで行われます。ここではカンファレンスのメイン日程でやるには若干ニッチだけど重要なテーマに関して、興味ある人が集まって発表や議論を行います。
私はその中の一つ、WebAssembly Summitに参加しました。
若干背伸び気味の参加でしたが、自分と同じような関心を持っている方と繋がれたりと実りのある体験でした。

自分はもともと[Pyodide](https://pyodide.org/)（WebAssembly向けにビルドされブラウザやNodeJSで動くCPython）を利用したOSSをいくつか開発しています。
そんな中でPyCon USのイベント情報を眺めていたら"WebAssembly Summit"の名前が目にき、その存在を知りました。
イベント情報には初心者向けではない旨、Pythonに限らずC,JS,Wasm,コンパイラなどに関する知識があればより楽しめる旨が注意書きされていて気後れしましたが、気になっているのに参加しないのも後悔するだろうと思い申し込みました。

希望者には発表の機会が設けられます。
せっかく初参加なので、自己紹介を兼ねて、発表を申し込みました。
自分の開発している、Pythonだけで書けてサーバサイド不要で動作するWeb UIフレームワーク[Stlite](https://github.com/whitphx/stlite)と[Gradio-Lite](https://www.gradio.app/guides/gradio-lite)の紹介と、そこから派生して最近取り組み始めている、ブラウザで実行する機械学習（WebML）関連の話題などを軽く話すトークです。

<!-- いざ部屋に行ってみると、参加者は10名ほどでした。
午前中は希望者が発表する時間で、午後にそれを踏まえて自由に議論を膨らませるという構成でした。 -->

他の方の発表は、注意書きの通り技術的に尖った発表が多かったです。
例えば、Pyodideのアプローチ（CPythonインタプリタをWasm向けにビルドする）の代わりに、より実行時オーバーヘッドを減らすためにPythonのバイトコードを直接Wasmにコンパイルするというアプローチの研究が紹介されました。発表者は大学で研究されている方で、アカデミックな学会の雰囲気でした。
また当然の如くPyodideの作者の方も発表していて、直近の進捗や今後の展望について話されていました。

自分の発表はWasm Pythonそのものに関連する技術に触れるものではないためどう捉えられるか不安でしたが、MCの方が親切に進行してくれました。
また、この場には Anaconda の PyScript プロジェクトの方が多く参加していて、その中の1人がかなり興味を持って話しかけてくれました。
その方は PyScript の文脈で、ツールチェインやAIなどを含めたアプリケーションの拡充などに関心があるようで、自分の興味・発表内容ともかなり親和的でした。

発表後の議論タイム（unconference）ではWasm周辺の技術的な話題が中心で、正直自分はほとんど聞くだけでしたが、
小さいテーブルの方で上記の PyScript の方と議論を深められたのが収穫でした。

総じて、Summitの名の通りかなり少数精鋭の感があるイベントで若干場違いな気持ちを勝手に感じてしまったものの、場の雰囲気は包摂的でそれなりに受け入れてもらえたと思います。
自分と重なる興味関心のある方とも繋がれました。
勇気を出して参加してみて良かったと思います。

### Sprint: First-time CPython Contributions

スプリントでは、First-time CPython Contributionsのテーブルに参加しました。
CPythonのリポジトリへの貢献を初めてやってみようというテーブルで、CPython開発者の方がその場にいて親切に導入してくれたり、議論や相談に乗ってくれます。
これがあるのはPyCon USとEuroPythonくらいではないかと思います。せっかくPyCon USに来たので飛び込んでみました。
結果的に、3.13から導入された新しいREPLに関する [issue](https://github.com/python/cpython/issues/127960) に取り組み、[PR](https://github.com/python/cpython/pull/134275)を出してマージされるところまでできました。

<!-- 当日部屋に行って、スプリントリーダーらしき人に声をかけつつまだ始まったばかりという気配のテーブルを選んで席に着くと、軽く流れを説明してくれました。
始め方に関してはドキュメントにまとまっていて、[PyCon USのブログのスプリントに関する記事](https://pycon.blogspot.com/2025/04/pyconus-sprints.html)でスプリントに関する一般的な情報をおさらいし、技術的な部分は[Python Developer’s Guide](https://devguide.python.org/getting-started/setup-building/)に従ってセットアップしていきます。

セットアップと並行して、取り組むissueを見つけるように促されました。
自分で見つけたバグや機能要望から出発するのではなく、OSSへの貢献そのものを目的にしてissueから探し始めるというのは普段やらないため新鮮でした。
CPythonリポジトリではこういう場で初心者が取り組みやすいissueに `easy` label をつけて管理しています。
しかし実際には `easy` のissueはスプリント参加者数に対して足りておらず、すぐに売り切れて取り組めるものがなくなってしまいました。同じテーブルの参加者も同様に困っており、スプリントリーダーに相談してみても、こればかりはどうしようもないという感じでした。

仕方がないので `easy` 以外のissueからできそうなものを探しました。とはいえissueは5k+個あるので、適当な条件で絞ります。
* `easy` labelのissueリストを眺めた時に（ドキュメント修正以外では）`topic-repl` labelの共起が多い印象だったので、このlabelで検索しました。3.13から入った新しいREPLは実装言語がPythonになったので、Cを書かなくても貢献できそうという見込みもありました。
* 数年経っているようなissueは除くようにアドバイスを受けました。長く残っているということは解決が難しい可能性が高いからです。
* コメント数が多いissueはすでに誰かが取り組んでいる可能性が高いので、今回の目的からは除外します。同様にassigneeがいるissueも当然除外します。 -->

<!-- TODO: 上記の短縮版を書く -->

その結果 https://github.com/python/cpython/issues/127960 を見つけました。新しいREPLでは相対インポートの挙動が従来のREPLと違っているという指摘です。
自分の手元で最新のコミットでも問題を再現できることを確認し、修正点のアテをつけてから issue に自分がスプリントで取り組みたい旨の[コメント](https://github.com/python/cpython/issues/127960#issuecomment-2891721324)を残しました。

早々に関連する箇所を見つけ、Pythonコードに1行足すだけでissueの指摘事項を直せることが分かりました。

しかしその修正はなんともその場限りで、問題の根本的な原因を探って一貫性のある修正を模索してみました。するとCで書かれた部分にまで手が及び、また元の実装の意図と違うデザインを導入してしまうことになりました。

このまま頑張っても手戻りのリスクが大きいと判断し、この時点でスプリントリーダーに相談しました。
すると、PyREPLのメイン実装者の[Pablo](https://github.com/pablogsal)にその場で繋いでくれました。こういうことが気軽に起きるのが現地開催のスプリントの良い点です。

Pablo に上記の懸念を伝えると、以下のような返答でした。
* issue としてはエッジケース寄りなのであまり大きな修正は労力の割に合わないだろうから無理しなくてもよく、現状を正として、ここでの議論をコメントに残しつつ issue を close するのも選択肢である。
* 一方で私が実装を頑張るなら上記の実装方針には同意できるしレビューするのも問題ない。

私としてはせっかくなのでまず実装を頑張ってみて、どうしようもなくなったら妥協してissueに議論の過程だけ残して撤退することにし、Pabloにもその方針を伝えました。

撤退も視野に入れつつ最初の実装を終えていざdraft PRを作ったところで、テストコードで担保されている、つまり元の実装者が意図的・明示的に選択した挙動を破壊してしまうことが判明しました。ここで1日目が終わり、draft PRをそのまま寝かせていたら、後日、別のコア開発者[Łukasz](https://github.com/ambv)が議論に加わってくれて、私の実装方針を支持してくれ、当該テストコードを削除してくれました。また[Tomas](https://github.com/tomasr8)が、PyREPLのimport文の挙動を変えるとautocompleteにも修正が必要である点を指摘してくれました。
最終的にこれらの後押しを受けて実装とテストコードを拡充し、最終的にマージされるところまで至りました。

プログラミング言語そのもののリポジトリに自分のコードが入るは初めての経験でした。
このスプリントは、CPythonのような大きなOSSに対して何らかの貢献を始めるために、とても良い助走の機会を提供してくれたと感じます。コア開発者の方々が気軽に議論に加わってサポートしてくれるため、大きなハードルを感じずに出したPRがマージされるところまでやり切れました。

<!-- CPythonリポジトリのマネジメントは技術的にも大規模プロジェクトとして洗練されていました。例えばCPythonプロジェクトでは、出したPRをマージするまでにContributor License Agreement (CLA)　へのサインが求められます。これ自体は大きめのOSSでは割と一般的な手続きかと思います。
CPythonではCLAへのサインを含む必要な手続きや実装上の作業（リリースブランチへのバックポートなど）がbotで自動化されていて、ほぼ追加の労力なしに出したPRがマージ可能な状態になりました。
特にスプリントは多くの初参加者が短期間で成果をあげないといけない特殊な状況ですが、このような自動化はそのハードルを下げるのに一役買っているでしょう。 -->

また月並みな感想ですが、最近のAIの性能向上によって、CPythonのようなプロジェクトの実装に新しく参加するハードルは下がっていると実感しました。
この時自分はCursorを使っていましたが、AIがコードリーディングの速度をかなり上げてくれました。それなりに長いCやPythonのコードを依存関係をジャンプしながら全容を把握する代わりに、AI chat に説明させることでかなり短時間でコードベースを把握して、スプリント中に実装を進められたと思います。
<!-- 一方でCPython程度に複雑なコードベースに対して、例えば上記 issue をそのままAIに投げてマージに値するコードを人間以上に早く書かせるのはまだ難しそうです。 -->
